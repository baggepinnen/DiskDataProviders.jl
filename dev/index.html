<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>DiskDataProviders · DiskDataProviders</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>DiskDataProviders</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>DiskDataProviders</a><ul class="internal"><li class="toplevel"><a class="toctext" href="#Preprocess-data-1">Preprocess data</a></li><li class="toplevel"><a class="toctext" href="#Exported-functions-and-types-1">Exported functions and types</a></li><li><a class="toctext" href="#Index-1">Index</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>DiskDataProviders</a></li></ul><a class="edit-page" href="https://github.com/baggepinnen/DiskDataProviders.jl/blob/master/docs/src/index.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>DiskDataProviders</span><a class="fa fa-bars" href="#"></a></div></header><p><a href="https://travis-ci.org/baggepinnen/DiskDataProviders.jl"><img src="https://travis-ci.org/baggepinnen/DiskDataProviders.jl.svg?branch=master" alt="Build Status"/></a> <a href="https://codecov.io/gh/baggepinnen/DiskDataProviders.jl"><img src="https://codecov.io/gh/baggepinnen/DiskDataProviders.jl/branch/master/graph/badge.svg" alt="codecov"/></a></p><h1><a class="nav-anchor" id="DiskDataProviders-1" href="#DiskDataProviders-1">DiskDataProviders</a></h1><div></div><p>This package implements datastructures that are iterable and backed by a buffer that is fed by data from disk. If Reading and preproccesing data is faster than one training step, it&#39;s recommended to use a <a href="#DiskDataProviders.ChannelDiskDataProvider-Tuple{ChannelDiskDataProvider,AbstractArray}"><code>ChannelDiskDataProvider</code></a>, if the training step is fast but reading data takes long time, <a href="#DiskDataProviders.QueueDiskDataProvider-Tuple{QueueDiskDataProvider,AbstractArray}"><code>QueueDiskDataProvider</code></a> is recommended. Both types do the reading on a separate thread, so make sure Julia is started with at least two threads.</p><p>Usage example</p><pre><code class="language-julia">using DiskDataProviders, Test, Serialization, MLDataUtils

# === Create some random example data ===
dirpath = mktempdir()*&quot;/&quot;
N = 100
T = 500
batch_size = 2
queue_length = 5 # Length of the internal buffer.
labs = rand(1:5, N)
for i = 1:N
    a = randn(T)
    serialize(dirpath*&quot;$(i).bin&quot;, (a, labs[i]))
end

files = dirpath .* string.(1:N) .* &quot;.bin&quot;

# === Create a DiskDataProvider ===
dataset = ChannelDiskDataProvider{Vector{Float64}, Int}((T,), batch_size, queue_length; labels=labs, files=files)</code></pre><pre><code class="language-none">ChannelDiskDataProvider{Array{Float64,1},Int64,Array{Float32,2}}, length: 100
</code></pre><p>The dataset is iterable and can be used in loops etc. One can also create a <a href="@ref"><code>BatchView</code></a>, which is an iterator over batches. The batch size is defined when the DiskDataProvider is created.</p><pre><code class="language-julia-repl">julia&gt; # === Example usage of the provider ===
       datasett, datasetv = stratifiedobs(dataset, 0.75)
(ChannelDiskDataProvider{Array{Float64,1},Int64,Array{Float32,2}}, length: 75
, ChannelDiskDataProvider{Array{Float64,1},Int64,Array{Float32,2}}, length: 25
)

julia&gt; sort(dataset.ulabels) == 1:5
true

julia&gt; x,y = first(dataset) # Get one datapoint
([-2.1578167386083105, 0.09368854470032875, -0.5963176610021862, -1.0521762904285115, 0.9490563649888674, -0.8928365716863352, -0.6012525617083575, 0.8295691262004078, -0.09471602918074815, -0.24910584342749015  …  1.5387397040770396, 0.2949718836367055, 3.102118199489188, 0.1404768907709827, -0.711161792187153, -0.5448660087199222, 1.051561184281747, -0.2291975412302962, 0.23852692068726727, -0.509993603903027], 2)

julia&gt; t = start_reading(dataset) # this function initiates the reading into the buffer
[ Info: Populating queue continuosly. Call `stop!(d)` to stop reading`. Call `wait(d)` to be notified when the queue is fully populated.
Task (runnable) @0x00007fce47ecbd00

julia&gt; wait(dataset) # Wait for the reading to start before proceeding

julia&gt; bw = batchview(dataset);

julia&gt; xb,yb = first(bw) # Get the first batch from the buffer
(Float32[0.6980342 -0.07743709; 2.231247 1.3908736; … ; 0.8391621 -0.70665395; -0.20319659 -1.7361624], [3, 1])

julia&gt; for (x,y) in bw # Iterate the batches in the batchview
           # do something with the data
       end

julia&gt; stop!(dataset) # Stop reading into the buffer
false</code></pre><p>If your data has more dimensions than 1, e.g., inputs are matrices or 3d-tensors, you create a DiskDataProvider like this</p><pre><code class="language-julia">dataset = ChannelDiskDataProvider((nrows,ncols,nchannels), batchsize, queuelength; labels=labs, files=files)</code></pre><p>notice that you have to provide <code>nchannels</code>, which is <code>1</code> if the input is a matrix.</p><h1><a class="nav-anchor" id="Preprocess-data-1" href="#Preprocess-data-1">Preprocess data</a></h1><p>All functionality in this package operates on serialized, preprocessed data files. Serialized files are fast to read, and storing already preprocessed data cuts down on overhead. This package does currently not support arbitrary file formats. The files are read using Julias built in deserializer.</p><h1><a class="nav-anchor" id="Exported-functions-and-types-1" href="#Exported-functions-and-types-1">Exported functions and types</a></h1><h2><a class="nav-anchor" id="Index-1" href="#Index-1">Index</a></h2><ul><li><a href="#DiskDataProviders.BufferedIterator"><code>DiskDataProviders.BufferedIterator</code></a></li><li><a href="#DiskDataProviders.ChannelDiskDataProvider-Union{Tuple{YT}, Tuple{XT}, Tuple{Any,Any,Int64}} where YT where XT"><code>DiskDataProviders.ChannelDiskDataProvider</code></a></li><li><a href="#DiskDataProviders.ChannelDiskDataProvider-Tuple{ChannelDiskDataProvider,AbstractArray}"><code>DiskDataProviders.ChannelDiskDataProvider</code></a></li><li><a href="#DiskDataProviders.QueueDiskDataProvider-Union{Tuple{YT}, Tuple{XT}, Tuple{Any,Any,Int64}} where YT where XT"><code>DiskDataProviders.QueueDiskDataProvider</code></a></li><li><a href="#DiskDataProviders.QueueDiskDataProvider-Tuple{QueueDiskDataProvider,AbstractArray}"><code>DiskDataProviders.QueueDiskDataProvider</code></a></li><li><a href="#DiskDataProviders.UnbufferedIterator"><code>DiskDataProviders.UnbufferedIterator</code></a></li><li><a href="#DiskDataProviders.labels-Tuple{Any}"><code>DiskDataProviders.labels</code></a></li><li><a href="#DiskDataProviders.sample_input-Tuple{Any}"><code>DiskDataProviders.sample_input</code></a></li><li><a href="#DiskDataProviders.sample_input-Tuple{Any,Any}"><code>DiskDataProviders.sample_input</code></a></li><li><a href="#DiskDataProviders.sample_label-Tuple{Any}"><code>DiskDataProviders.sample_label</code></a></li><li><a href="#DiskDataProviders.start_reading-Tuple{DiskDataProviders.AbstractDiskDataProvider}"><code>DiskDataProviders.start_reading</code></a></li></ul><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DiskDataProviders.BufferedIterator" href="#DiskDataProviders.BufferedIterator"><code>DiskDataProviders.BufferedIterator</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">struct BufferedIterator{T &lt;: AbstractDiskDataProvider}</code></pre><p>Creates an iterator which uses the underlying buffer in the dataset.</p></div></div><a class="source-link" target="_blank" href="https://github.com/baggepinnen/DiskDataProviders.jl/blob/eb860e9ae0cb5439c16752d9e1a2e48dd55b0996/src/iteration.jl#L76-L80">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DiskDataProviders.ChannelDiskDataProvider-Tuple{ChannelDiskDataProvider,AbstractArray}" href="#DiskDataProviders.ChannelDiskDataProvider-Tuple{ChannelDiskDataProvider,AbstractArray}"><code>DiskDataProviders.ChannelDiskDataProvider</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">ChannelDiskDataProvider(d::ChannelDiskDataProvider, inds::AbstractArray)</code></pre><p>This constructor can be used to create a dataprovider that is a subset of another.</p></div></div><a class="source-link" target="_blank" href="https://github.com/baggepinnen/DiskDataProviders.jl/blob/eb860e9ae0cb5439c16752d9e1a2e48dd55b0996/src/DiskDataProviders.jl#L135-L139">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DiskDataProviders.ChannelDiskDataProvider-Union{Tuple{YT}, Tuple{XT}, Tuple{Any,Any,Int64}} where YT where XT" href="#DiskDataProviders.ChannelDiskDataProvider-Union{Tuple{YT}, Tuple{XT}, Tuple{Any,Any,Int64}} where YT where XT"><code>DiskDataProviders.ChannelDiskDataProvider</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">ChannelDiskDataProvider{XT, YT}(xsize, batchsize, queuelength::Int; kwargs...) where {XT, YT}</code></pre><p>Constructor for ChannelDiskDataProvider. <code>{XT, YT}</code> are the types of the input and output respectively.</p><p>#Arguments:</p><ul><li><code>xsize</code>: Tuple with sixe of each data point</li><li><code>batchsize</code>: how many datapoints to put in a batch</li><li><code>queuelength</code>: length of buffer</li><li><code>kwargs</code>: to set the other fields of the structure.</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/baggepinnen/DiskDataProviders.jl/blob/eb860e9ae0cb5439c16752d9e1a2e48dd55b0996/src/DiskDataProviders.jl#L107-L118">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DiskDataProviders.QueueDiskDataProvider-Tuple{QueueDiskDataProvider,AbstractArray}" href="#DiskDataProviders.QueueDiskDataProvider-Tuple{QueueDiskDataProvider,AbstractArray}"><code>DiskDataProviders.QueueDiskDataProvider</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">QueueDiskDataProvider(d::QueueDiskDataProvider, inds::AbstractArray)</code></pre><p>This constructor can be used to create a dataprovider that is a subset of another.</p></div></div><a class="source-link" target="_blank" href="https://github.com/baggepinnen/DiskDataProviders.jl/blob/eb860e9ae0cb5439c16752d9e1a2e48dd55b0996/src/DiskDataProviders.jl#L65-L69">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DiskDataProviders.QueueDiskDataProvider-Union{Tuple{YT}, Tuple{XT}, Tuple{Any,Any,Int64}} where YT where XT" href="#DiskDataProviders.QueueDiskDataProvider-Union{Tuple{YT}, Tuple{XT}, Tuple{Any,Any,Int64}} where YT where XT"><code>DiskDataProviders.QueueDiskDataProvider</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">QueueDiskDataProvider{XT, YT}(xsize, batchsize, queuelength::Int; kwargs...) where {XT, YT}</code></pre><p>Constructor for QueueDiskDataProvider.</p><p><code>{XT, YT}</code> are the types of the input and output respectively.</p><p>#Arguments:</p><ul><li><code>xsize</code>: Tuple with sixe of each data point</li><li><code>batchsize</code>: how many datapoints to put in a batch</li><li><code>queuelength</code>: length of buffer</li><li><code>kwargs</code>: to set the other fields of the structure.</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/baggepinnen/DiskDataProviders.jl/blob/eb860e9ae0cb5439c16752d9e1a2e48dd55b0996/src/DiskDataProviders.jl#L35-L47">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DiskDataProviders.UnbufferedIterator" href="#DiskDataProviders.UnbufferedIterator"><code>DiskDataProviders.UnbufferedIterator</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">struct UnbufferedIterator{T &lt;: AbstractDiskDataProvider}</code></pre><p>Creates an iterator which does not use the underlying buffer in the dataset.</p></div></div><a class="source-link" target="_blank" href="https://github.com/baggepinnen/DiskDataProviders.jl/blob/eb860e9ae0cb5439c16752d9e1a2e48dd55b0996/src/iteration.jl#L85-L89">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DiskDataProviders.labels-Tuple{Any}" href="#DiskDataProviders.labels-Tuple{Any}"><code>DiskDataProviders.labels</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">labels(d)</code></pre><p>Return the labels in the dataset</p></div></div><a class="source-link" target="_blank" href="https://github.com/baggepinnen/DiskDataProviders.jl/blob/eb860e9ae0cb5439c16752d9e1a2e48dd55b0996/src/DiskDataProviders.jl#L176-L180">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DiskDataProviders.sample_input-Tuple{Any,Any}" href="#DiskDataProviders.sample_input-Tuple{Any,Any}"><code>DiskDataProviders.sample_input</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">sample_input(d::AbstractDiskDataProvider, y)</code></pre><p>Sample one input with label <code>y</code> from the dataset</p></div></div><a class="source-link" target="_blank" href="https://github.com/baggepinnen/DiskDataProviders.jl/blob/eb860e9ae0cb5439c16752d9e1a2e48dd55b0996/src/DiskDataProviders.jl#L267-L271">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DiskDataProviders.sample_input-Tuple{Any}" href="#DiskDataProviders.sample_input-Tuple{Any}"><code>DiskDataProviders.sample_input</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">sample_input(d::AbstractDiskDataProvider)</code></pre><p>Sample one datapoint from the dataset</p></div></div><a class="source-link" target="_blank" href="https://github.com/baggepinnen/DiskDataProviders.jl/blob/eb860e9ae0cb5439c16752d9e1a2e48dd55b0996/src/DiskDataProviders.jl#L279-L283">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DiskDataProviders.sample_label-Tuple{Any}" href="#DiskDataProviders.sample_label-Tuple{Any}"><code>DiskDataProviders.sample_label</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">sample_label(d)</code></pre><p>Sample a random label from the dataset</p></div></div><a class="source-link" target="_blank" href="https://github.com/baggepinnen/DiskDataProviders.jl/blob/eb860e9ae0cb5439c16752d9e1a2e48dd55b0996/src/DiskDataProviders.jl#L255-L259">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DiskDataProviders.start_reading-Tuple{DiskDataProviders.AbstractDiskDataProvider}" href="#DiskDataProviders.start_reading-Tuple{DiskDataProviders.AbstractDiskDataProvider}"><code>DiskDataProviders.start_reading</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">start_reading(d::AbstractDiskDataProvider)</code></pre><p>Initialize reading into the buffer. This function has to be called before the dataset is used. Reading will continue until you call <code>stop!</code> on the dataset. If the dataset is a <a href="#DiskDataProviders.ChannelDiskDataProvider-Tuple{ChannelDiskDataProvider,AbstractArray}"><code>ChannelDiskDataProvider</code></a>, this is a non-issue.</p></div></div><a class="source-link" target="_blank" href="https://github.com/baggepinnen/DiskDataProviders.jl/blob/eb860e9ae0cb5439c16752d9e1a2e48dd55b0996/src/DiskDataProviders.jl#L243-L247">source</a></section><footer><hr/></footer></article></body></html>
